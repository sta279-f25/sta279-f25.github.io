<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exam 2 review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="exam_2_review_solutions_files/libs/clipboard/clipboard.min.js"></script>
<script src="exam_2_review_solutions_files/libs/quarto-html/quarto.js"></script>
<script src="exam_2_review_solutions_files/libs/quarto-html/popper.min.js"></script>
<script src="exam_2_review_solutions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="exam_2_review_solutions_files/libs/quarto-html/anchor.min.js"></script>
<link href="exam_2_review_solutions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="exam_2_review_solutions_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="exam_2_review_solutions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="exam_2_review_solutions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="exam_2_review_solutions_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exam 2 review</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Below are questions to help you study for Exam 2. These are some examples of the kinds of questions I might ask.</p>
<ul>
<li>This is not a practice exam. There will be fewer questions on the actual exam.</li>
<li>The questions cover most, but not all, possible material for the exam.</li>
<li>The distribution of questions here is not necessarily reflective of the distribution of questions on the actual exam.</li>
</ul>
<section id="strings-and-regular-expressions" class="level1">
<h1>Strings and regular expressions</h1>
<section id="example-1" class="level2">
<h2 class="anchored" data-anchor-id="example-1">Example 1</h2>
<p>Consider the following strings:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "George Washington: February 22, 1732"
[2] "Thomas Jefferson: April 13, 1743"    
[3] "Abraham Lincoln: February 12, 1809"  
[4] "Theodore Roosevelt: October 27, 1858"</code></pre>
</div>
</div>
<p>For each question below, fill in the R code to produce the desired output.</p>
<ol type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(strings, <span class="st">".+(?=:)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "George Washington"  "Thomas Jefferson"   "Abraham Lincoln"   
[4] "Theodore Roosevelt"</code></pre>
</div>
</div>
<ol start="2" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(strings, <span class="st">"(?&lt;=: ).+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "February 22, 1732" "April 13, 1743"    "February 12, 1809"
[4] "October 27, 1858" </code></pre>
</div>
</div>
<ol start="3" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(strings, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s).+(?=:)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Washington" "Jefferson"  "Lincoln"    "Roosevelt" </code></pre>
</div>
</div>
<ol start="4" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(strings, <span class="st">"(?&lt;=, ).+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1732" "1743" "1809" "1858"</code></pre>
</div>
</div>
</section>
<section id="example-2" class="level2">
<h2 class="anchored" data-anchor-id="example-2">Example 2</h2>
<p>Consider the following strings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>strings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "apple"           "banana"          "canteloupe"      "durian"         
 [5] "eggplant"        "french fries"    "goat cheese"     "pizza"          
 [9] "99 red balloons" "101 dalmatians"  "route 66"       </code></pre>
</div>
</div>
<p>For each question below, fill in the R code to produce the desired output.</p>
<ol start="5" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(strings, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "99 red balloons" "101 dalmatians"  "route 66"       </code></pre>
</div>
</div>
<ol start="6" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(strings, <span class="st">"^</span><span class="sc">\\</span><span class="st">d+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "99 red balloons" "101 dalmatians" </code></pre>
</div>
</div>
<ol start="7" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(strings, <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple"           "banana"          "canteloupe"      "durian"         
[5] "eggplant"        "goat cheese"     "pizza"           "99 red balloons"
[9] "101 dalmatians" </code></pre>
</div>
</div>
<ol start="8" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(strings, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "french fries"    "goat cheese"     "99 red balloons" "101 dalmatians" 
[5] "route 66"       </code></pre>
</div>
</div>
<ol start="9" type="1">
<li></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(strings, <span class="st">"(.)</span><span class="sc">\\</span><span class="st">1{1}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple"           "eggplant"        "goat cheese"     "pizza"          
[5] "99 red balloons" "route 66"       </code></pre>
</div>
</div>
</section>
<section id="example-3" class="level2">
<h2 class="anchored" data-anchor-id="example-3">Example 3</h2>
<p>Suppose you receive a vector containing the following email addresses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>emails <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"evansc@wfu.edu"</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"dalzelnm@wfu.edu"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"heplersa@wfu.edu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="10" type="1">
<li>Fill in the following code to produce the desired output:</li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(emails, <span class="st">"^.+(?=@)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "evansc"   "dalzelnm" "heplersa"</code></pre>
</div>
</div>
</section>
<section id="example-4" class="level2">
<h2 class="anchored" data-anchor-id="example-4">Example 4</h2>
<p>You have a folder with the following filenames:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>filenames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">".bash_profile"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"workspace.doc"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"img0912.jpg"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"updated_img0912.png"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"documentation.html"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">"favicon.gif"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"access.lock"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="11" type="1">
<li>Fill in the following code to produce the desired output:</li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(filenames, <span class="st">"(gif|png|jpg)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "img0912.jpg"         "updated_img0912.png" "favicon.gif"        </code></pre>
</div>
</div>
</section>
<section id="example-5" class="level2">
<h2 class="anchored" data-anchor-id="example-5">Example 5</h2>
<p>Consider the following string:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ex_str <span class="ot">&lt;-</span> <span class="st">"The kurtosis is defined by the equation $</span><span class="sc">\\</span><span class="st">mu_4/</span><span class="sc">\\</span><span class="st">sigma^4$, </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="st">where $</span><span class="sc">\\</span><span class="st">mu_4$ is the fourth central moment </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="st">and $</span><span class="sc">\\</span><span class="st">sigma$ is the standard deviation."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="12" type="1">
<li>Fill in the following code to produce the desired output:</li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(ex_str, <span class="st">"</span><span class="sc">\\</span><span class="st">$[^</span><span class="sc">\\</span><span class="st">$]+</span><span class="sc">\\</span><span class="st">$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "$\\mu_4/\\sigma^4$" "$\\mu_4$"           "$\\sigma$"         </code></pre>
</div>
</div>
</section>
<section id="example-6" class="level2">
<h2 class="anchored" data-anchor-id="example-6">Example 6</h2>
<p>Here is another small dataset, <code>ex_df</code>, which has a single column (<code>faculty</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ex_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                faculty
1                       Rob Erhardt, Professor: MAN 343
2          Daniel Beavers, Associate Professor: MAN 337
3                 Kenneth Berenhaut, Professor: MAN 379
4          Leonardo Cella, Assistant Professor: MAN 344
5 Lucy D'Agostino McGowan, Assistant Professor: MAN 342
6 Nicole Dalzell, Associate Teaching Professor: MAN 338</code></pre>
</div>
</div>
<ol start="13" type="1">
<li>Write code to produce the following output using <code>ex_df</code>:</li>
</ol>
<p><strong>Solution:</strong></p>
<p>Option 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ex_df <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_extract</span>(faculty, <span class="st">".+(?=,)"</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">position =</span> <span class="fu">str_extract</span>(faculty, <span class="st">"(?&lt;=, ).+(?=:)"</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">office =</span> <span class="fu">str_extract</span>(faculty, <span class="st">"(?&lt;=: ).+"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>faculty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     name                     position  office
1             Rob Erhardt                    Professor MAN 343
2          Daniel Beavers          Associate Professor MAN 337
3       Kenneth Berenhaut                    Professor MAN 379
4          Leonardo Cella          Assistant Professor MAN 344
5 Lucy D'Agostino McGowan          Assistant Professor MAN 342
6          Nicole Dalzell Associate Teaching Professor MAN 338</code></pre>
</div>
</div>
<p>Option 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ex_df <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_regex</span>(faculty,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">patterns =</span> <span class="fu">c</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name =</span> <span class="st">".+"</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">", "</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">position =</span> <span class="st">".+"</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">": "</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">office =</span> <span class="st">".+"</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                       ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  name                    position                     office 
  &lt;chr&gt;                   &lt;chr&gt;                        &lt;chr&gt;  
1 Rob Erhardt             Professor                    MAN 343
2 Daniel Beavers          Associate Professor          MAN 337
3 Kenneth Berenhaut       Professor                    MAN 379
4 Leonardo Cella          Assistant Professor          MAN 344
5 Lucy D'Agostino McGowan Assistant Professor          MAN 342
6 Nicole Dalzell          Associate Teaching Professor MAN 338</code></pre>
</div>
</div>
</section>
</section>
<section id="web-scraping" class="level1">
<h1>Web scraping</h1>
<section id="example-1-1" class="level2">
<h2 class="anchored" data-anchor-id="example-1-1">Example 1</h2>
<p>Consider the following portion of a web page:</p>
<h1>
STA 279
</h1>
<p>
Welcome to STA 279! This is a 16-week course offered at Wake Forest University, which meets 3 hours each week. The syllabus can be found <a href="https://sta279-f25.github.io/about/">here</a>
</p>
<p>
Below are some useful dates for the semester:
</p><table>
<tbody><tr>
<td>
Exam 1
</td>
<td>
March 1
</td>
</tr>
<tr>
<td>
Exam 2
</td>
<td>
April 12
</td>
</tr>
</tbody></table>
<p></p>
<p>Now here is the source HTML for that simple web page:</p>
<pre><code>&lt;h1&gt; STA 279 &lt;/h1&gt;

&lt;p&gt; 
  Welcome to STA 279! 
  This is a 16-week course offered at Wake Forest University, 
  which meets 3 hours each week. 
  The syllabus can be found 
  &lt;a href='https://sta279-f25.github.io/about/'&gt;here&lt;/a&gt; 
&lt;/p&gt;

&lt;p&gt;
  Below are some useful dates for the semester:
   &lt;table&gt;
  &lt;tr&gt;
    &lt;td&gt;Exam 1&lt;/td&gt;
    &lt;td&gt;March 1&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Exam 2&lt;/td&gt;
    &lt;td&gt;April 12&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt; 
&lt;/p&gt;</code></pre>
<ol start="14" type="1">
<li>Suppose that the url for this page is “https://fake_web_page.html”. Write code that will import the table of exam dates into R, as a data frame.</li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://fake_web_page.html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="15" type="1">
<li>Suppose that the url for this page is “https://fake_web_page.html”. What will the following code return?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://fake_web_page.html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"h1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>() <span class="sc">|&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Solution:</strong> 279</p>
</section>
<section id="example-2-1" class="level2">
<h2 class="anchored" data-anchor-id="example-2-1">Example 2</h2>
<p>Consider the following short portion of a web page, with URL <code>https://fake_page.html</code>.</p>
<pre><code>&lt;div class="mesa"&gt;
  &lt;span&gt;
    &lt;p&gt; Hello! &lt;/p&gt;
  &lt;/span&gt;
  
  &lt;p class="small"&gt; Welcome to STA 279! &lt;/p&gt;
  
  &lt;span&gt;
    &lt;p class="small"&gt; Room: Carswell 102 &lt;/p&gt;
  &lt;/span&gt;
  
  &lt;span&gt;
    &lt;h3 class="small"&gt; Grading policy &lt;/h3&gt;
  &lt;/span&gt;
  
  &lt;span&gt;
    &lt;p class="small"&gt; Exam dates &lt;/p&gt;
  &lt;/span&gt;
&lt;/div&gt;</code></pre>
<ol start="16" type="1">
<li>Write code in R that will extract the following string from this web page:</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Carswell 102"</code></pre>
</div>
</div>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://fake_page.html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"span &gt; p.small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="17" type="1">
<li>Using your code from the previous question, write a short function with the following specifications:
<ul>
<li>Input: <code>url</code> the URL for a web page with the same format as above</li>
<li>Output: the building and room number for the class, scraped from the web page</li>
</ul></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>get_room <span class="ot">&lt;-</span> <span class="cf">function</span>(url){</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"span &gt; p.small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="18" type="1">
<li>Suppose that we have the web pages for 20 different classes at Wake Forest, all of which have the same format as shown above, but which take places in different rooms. The URLS are stored in a vector:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>class_urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "https://fake_page_1.html"  "https://fake_page_2.html" 
 [3] "https://fake_page_3.html"  "https://fake_page_4.html" 
 [5] "https://fake_page_5.html"  "https://fake_page_6.html" 
 [7] "https://fake_page_7.html"  "https://fake_page_8.html" 
 [9] "https://fake_page_9.html"  "https://fake_page_10.html"
[11] "https://fake_page_11.html" "https://fake_page_12.html"
[13] "https://fake_page_13.html" "https://fake_page_14.html"
[15] "https://fake_page_15.html" "https://fake_page_16.html"
[17] "https://fake_page_17.html" "https://fake_page_18.html"
[19] "https://fake_page_19.html" "https://fake_page_20.html"</code></pre>
</div>
</div>
<p>Using your answers to the previous questions, iterate over this vector of URLs to produce a vector containing the building and room number for each class.</p>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(class_urls, get_room)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’m using <code>map_chr</code> here since I want to return a vector rather than a list. If I asked this question on the exam, I would also accept a solution with <code>map</code> in place of <code>map_chr</code>.</p>
</section>
<section id="polite-web-scraping" class="level2">
<h2 class="anchored" data-anchor-id="polite-web-scraping">Polite web scraping</h2>
<ol start="19" type="1">
<li><p>Why is it important to be polite when scraping from a website?</p></li>
<li><p>What are the features of polite web scraping that we discussed in class?</p></li>
</ol>
</section>
</section>
<section id="sql" class="level1">
<h1>SQL</h1>
<p>Here is a rough summary of what you should know from the SQL unit:</p>
<ul>
<li>Pieces of a SQL query you should know:
<ul>
<li><code>SELECT</code></li>
<li><code>FROM</code></li>
<li><code>JOIN</code> (an inner join) and <code>LEFT JOIN</code> (a left join)</li>
<li><code>WHERE</code></li>
<li><code>GROUP BY</code></li>
<li><code>HAVING</code></li>
<li><code>ORDER BY</code></li>
<li><code>LIMIT</code></li>
</ul></li>
<li>You should also know the order in which queries must be written</li>
<li>Other functions to know for queries:
<ul>
<li><code>DISTINCT</code></li>
<li>Summary functions like <code>SUM</code>, <code>AVG</code>, <code>MIN</code>, <code>MAX</code>, <code>COUNT</code></li>
<li><code>LIKE</code>, and the wildcards <code>%</code> and <code>_</code></li>
<li><code>CASE</code></li>
</ul></li>
<li>The function of primary and foreign keys, and the constraints they place on tables</li>
<li>How to read and interpret an ERD</li>
<li>You should be able to read and interpet the results of <code>DESCRIBE</code>, <code>ALTER TABLE</code>, and <code>INSERT INTO</code> statements. You will <em>not</em> have to write these statements</li>
<li>Subqueries</li>
</ul>
<section id="practice-with-sql-queries" class="level2">
<h2 class="anchored" data-anchor-id="practice-with-sql-queries">Practice with SQL queries</h2>
<p>Here is a small table in a SQL database. The name of the table is <code>small_penguins</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     species island bill_length_mm bill_depth_mm
1     Gentoo Biscoe           43.3          14.0
2     Gentoo Biscoe           59.6          17.0
3     Adelie  Dream           39.7          17.9
4     Adelie  Dream           39.2          21.1
5  Chinstrap  Dream           50.8          19.0
6     Gentoo Biscoe           49.9          16.1
7  Chinstrap  Dream           50.7          19.7
8     Gentoo Biscoe           47.3          15.3
9     Gentoo Biscoe           49.3          15.7
10    Adelie  Dream           37.5          18.9</code></pre>
</div>
</div>
<p>In each of the following examples, write a SQL query to produce the desired output from <code>small_penguins</code>.</p>
<ol start="21" type="1">
<li>Output:</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    species island n
1    Adelie  Dream 3
2 Chinstrap  Dream 2
3    Gentoo Biscoe 5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species, island, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">as</span> n</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> small_penguins</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species, island;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">island</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chinstrap</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: left;">Biscoe</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="22" type="1">
<li>Output:</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  island   species mean_length
1 Biscoe    Gentoo       49.88
2  Dream    Adelie       38.80
3  Dream Chinstrap       50.75</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> island, species, <span class="fu">AVG</span>(bill_length_mm) <span class="kw">AS</span> mean_length</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> small_penguins</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> island, species;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">island</th>
<th style="text-align: left;">species</th>
<th style="text-align: right;">mean_length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Biscoe</td>
<td style="text-align: left;">Gentoo</td>
<td style="text-align: right;">49.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dream</td>
<td style="text-align: left;">Adelie</td>
<td style="text-align: right;">38.80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dream</td>
<td style="text-align: left;">Chinstrap</td>
<td style="text-align: right;">50.75</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="23" type="1">
<li>Output:</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     species island bill_length_mm bill_depth_mm bill_ratio
1     Gentoo Biscoe           43.3          14.0   3.092857
2     Gentoo Biscoe           59.6          17.0   3.505882
3     Adelie  Dream           39.7          17.9   2.217877
4     Adelie  Dream           39.2          21.1   1.857820
5  Chinstrap  Dream           50.8          19.0   2.673684
6     Gentoo Biscoe           49.9          16.1   3.099379
7  Chinstrap  Dream           50.7          19.7   2.573604
8     Gentoo Biscoe           47.3          15.3   3.091503
9     Gentoo Biscoe           49.3          15.7   3.140127
10    Adelie  Dream           37.5          18.9   1.984127</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species, island, bill_length_mm, bill_depth_mm,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  bill_length_mm<span class="op">/</span>bill_depth_mm <span class="kw">AS</span> bill_ratio</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> small_penguins;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">island</th>
<th style="text-align: right;">bill_length_mm</th>
<th style="text-align: right;">bill_depth_mm</th>
<th style="text-align: right;">bill_ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: left;">Biscoe</td>
<td style="text-align: right;">43.3</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">3.092857</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: left;">Biscoe</td>
<td style="text-align: right;">59.6</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">3.505882</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">39.7</td>
<td style="text-align: right;">17.9</td>
<td style="text-align: right;">2.217877</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">39.2</td>
<td style="text-align: right;">21.1</td>
<td style="text-align: right;">1.857820</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chinstrap</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">50.8</td>
<td style="text-align: right;">19.0</td>
<td style="text-align: right;">2.673684</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: left;">Biscoe</td>
<td style="text-align: right;">49.9</td>
<td style="text-align: right;">16.1</td>
<td style="text-align: right;">3.099379</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chinstrap</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">50.7</td>
<td style="text-align: right;">19.7</td>
<td style="text-align: right;">2.573604</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: left;">Biscoe</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: right;">15.3</td>
<td style="text-align: right;">3.091503</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: left;">Biscoe</td>
<td style="text-align: right;">49.3</td>
<td style="text-align: right;">15.7</td>
<td style="text-align: right;">3.140127</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">37.5</td>
<td style="text-align: right;">18.9</td>
<td style="text-align: right;">1.984127</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="24" type="1">
<li>Output:</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  species island bill_length_mm bill_depth_mm
1  Adelie  Dream           39.7          17.9
2  Adelie  Dream           39.2          21.1
3  Adelie  Dream           37.5          18.9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species, island, bill_length_mm, bill_depth_mm</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> small_penguins</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">'Adelie'</span> <span class="kw">AND</span> island <span class="op">=</span> <span class="st">'Dream'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">island</th>
<th style="text-align: right;">bill_length_mm</th>
<th style="text-align: right;">bill_depth_mm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">39.7</td>
<td style="text-align: right;">17.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">39.2</td>
<td style="text-align: right;">21.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Dream</td>
<td style="text-align: right;">37.5</td>
<td style="text-align: right;">18.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="joins" class="level2">
<h2 class="anchored" data-anchor-id="joins">Joins</h2>
<p>In each of the following questions, write a SQL query to produce the desired output from the two input tables</p>
<ol start="25" type="1">
<li></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id  x
1  1  7
2  2  9
3  3 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id  y
1  1 10
2  2 12
3  4 14</code></pre>
</div>
</div>
<p>Output:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  id  x  y
1  1  7 10
2  2  9 12
3  3 13 NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> df1.<span class="kw">id</span>, x, y</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> df1 </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> df2 <span class="kw">ON</span> df1.<span class="kw">id</span> <span class="op">=</span> df2.<span class="kw">id</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="26" type="1">
<li></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id  x
1  1  7
2  2  9
3  3 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id  y
1  1 10
2  2 12
3  4 14</code></pre>
</div>
</div>
<p>Output:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  id x  y
1  1 7 10
2  2 9 12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> df1.<span class="kw">id</span>, x, y</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> df1 </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> df2 <span class="kw">ON</span> df1.<span class="kw">id</span> <span class="op">=</span> df2.<span class="kw">id</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="more-practice-with-sql-queries" class="level2">
<h2 class="anchored" data-anchor-id="more-practice-with-sql-queries">More practice with SQL queries</h2>
<p>The <code>nycflights13</code> package in R contains several datasets describing flights from NY airports in 2013, including the <code>airports</code> and <code>weather</code> tables.</p>
<p>The <code>airports</code> table has one row for each different airport in the database. There are a total of 1458 rows and 8 columns in the <code>airports</code> table; here are a few random rows from the table, showing the relevant columns for this question:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  faa                      name
1 AOS   Amook Bay Seaplane Base
2 2H0     Shelby County Airport
3 CEF Westover Arb Metropolitan
4 AVW           Marana Regional
5 DLF              Laughlin Afb</code></pre>
</div>
</div>
<p>The <code>weather</code> table has one row for each date-time, for each of the three NY airports (EWR, JFK, LGA), and records a variety of weather variables at each time for each location. Here are a few random rows from the table, showing the relevant columns for this question:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  origin month  temp humid
1    EWR    12 24.98 62.55
2    LGA     2 33.98 88.42
3    LGA     5 57.92 71.90
4    EWR     6 64.04 93.28
5    LGA     4 42.98 88.85</code></pre>
</div>
</div>
<p>The <code>weather</code> table uses a 3-character FAA code to identify each airport. It does <em>not</em> include the full name for the airports.</p>
<p>We would like to produce a table with the mean temperature, and humidity for each month, for each of the 3 NYC airports in the database. The output table should also include the full name of each airport. Here is what the output table looks like:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   origin                name month mean_temp mean_humid
1     EWR Newark Liberty Intl     1  35.56216   62.12451
2     EWR Newark Liberty Intl     2  34.26332   63.33558
3     EWR Newark Liberty Intl     3  40.11865   57.91382
4     EWR Newark Liberty Intl     4  52.97750   54.23513
5     EWR Newark Liberty Intl     5  63.32024   64.07371
6     EWR Newark Liberty Intl     6  73.26725   67.00229
7     EWR Newark Liberty Intl     7  80.70300   66.67641
8     EWR Newark Liberty Intl     8  74.53748   65.75175
9     EWR Newark Liberty Intl     9  67.30478   64.03556
10    EWR Newark Liberty Intl    10  59.77821   65.31928
11    EWR Newark Liberty Intl    11  44.57734   56.52011
12    EWR Newark Liberty Intl    12  37.95008   69.72141
13    JFK John F Kennedy Intl     1  35.38555   61.66162
14    JFK John F Kennedy Intl     2  34.19246   62.55848
15    JFK John F Kennedy Intl     3  39.54472   58.02222
16    JFK John F Kennedy Intl     4  50.14270   60.05764
17    JFK John F Kennedy Intl     5  59.31476   70.98926
18    JFK John F Kennedy Intl     6  69.95825   73.76147
19    JFK John F Kennedy Intl     7  78.73492   71.74469
20    JFK John F Kennedy Intl     8  73.81878   67.84420
21    JFK John F Kennedy Intl     9  66.89775   65.25182
22    JFK John F Kennedy Intl    10  59.80195   65.06362
23    JFK John F Kennedy Intl    11  45.13419   56.79961
24    JFK John F Kennedy Intl    12  38.60487   68.31341
25    LGA          La Guardia     1  35.95927   59.15609
26    LGA          La Guardia     2  34.35612   60.68603
27    LGA          La Guardia     3  39.97652   56.55947
28    LGA          La Guardia     4  52.11450   53.15060
29    LGA          La Guardia     5  62.75000   61.49618
30    LGA          La Guardia     6  73.32650   61.22686
31    LGA          La Guardia     7  80.76425   62.26404
32    LGA          La Guardia     8  75.04825   60.34574
33    LGA          La Guardia     9  67.91125   59.67743
34    LGA          La Guardia    10  60.63244   60.13875
35    LGA          La Guardia    11  45.26093   53.49296
36    LGA          La Guardia    12  38.76976   63.62769</code></pre>
</div>
</div>
<ol start="27" type="1">
<li>Write a SQL query to produce the desired results.</li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> weather.origin, name, <span class="dt">month</span>, </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AVG</span>(temp) <span class="kw">AS</span> mean_temp, <span class="fu">AVG</span>(humid) <span class="kw">AS</span> mean_humid</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> weather</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> airports <span class="kw">ON</span> weather.origin <span class="op">=</span> airports.faa</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> origin, name, <span class="dt">month</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> origin, <span class="dt">month</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">mean_temp</th>
<th style="text-align: right;">mean_humid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">35.56216</td>
<td style="text-align: right;">62.12451</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">34.26332</td>
<td style="text-align: right;">63.33558</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">40.11865</td>
<td style="text-align: right;">57.91382</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">52.97750</td>
<td style="text-align: right;">54.23512</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">63.32024</td>
<td style="text-align: right;">64.07371</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">73.26725</td>
<td style="text-align: right;">67.00229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80.70300</td>
<td style="text-align: right;">66.67641</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">74.53748</td>
<td style="text-align: right;">65.75175</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">67.30478</td>
<td style="text-align: right;">64.03556</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">59.77821</td>
<td style="text-align: right;">65.31928</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="28" type="1">
<li>How would you modify your above query to keep only the rows in the results for which the mean temperature is at least 60?</li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> weather.origin, name, <span class="dt">month</span>, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AVG</span>(temp) <span class="kw">AS</span> mean_temp, <span class="fu">AVG</span>(humid) <span class="kw">AS</span> mean_humid</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> weather</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> airports <span class="kw">ON</span> weather.origin <span class="op">=</span> airports.faa</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> origin, name, <span class="dt">month</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> mean_temp <span class="op">&gt;=</span> <span class="dv">60</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> origin, <span class="dt">month</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">mean_temp</th>
<th style="text-align: right;">mean_humid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">63.32024</td>
<td style="text-align: right;">64.07371</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">73.26725</td>
<td style="text-align: right;">67.00229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80.70300</td>
<td style="text-align: right;">66.67641</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">74.53748</td>
<td style="text-align: right;">65.75175</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">67.30478</td>
<td style="text-align: right;">64.03556</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">69.95825</td>
<td style="text-align: right;">73.76147</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">78.73492</td>
<td style="text-align: right;">71.74469</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">73.81878</td>
<td style="text-align: right;">67.84420</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">66.89775</td>
<td style="text-align: right;">65.25182</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">62.75000</td>
<td style="text-align: right;">61.49618</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="29" type="1">
<li>How would you modify your above query to keep only the rows for which the mean temperature is the highest average temperature?</li>
</ol>
<p><strong>Solution:</strong> This is quite tricky, and requires us to combine some queries.</p>
<p>Assuming that we want to get the highest average monthly temperature for each airport, a partial answer is the following, though note that this only gives us the origin and max mean temperature columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> origin, <span class="fu">MAX</span>(mean_temp)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> weather.origin, name, <span class="dt">month</span>, </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">AVG</span>(temp) <span class="kw">AS</span> mean_temp, <span class="fu">AVG</span>(humid) <span class="kw">AS</span> mean_humid</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> weather</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">JOIN</span> airports <span class="kw">ON</span> weather.origin <span class="op">=</span> airports.faa</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> origin, name, <span class="dt">month</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> origin, <span class="dt">month</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> origin;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: right;">max(mean_temp)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: right;">80.76425</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: right;">80.70300</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: right;">78.73492</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This partial solution uses a subquery, and this is about the level of difficulty I would put on the exam.</p>
<p>A full solution is beyond the scope of the exam, and I think requires us to use either multiple subqueries, or to create an intermediate view/table. Here is one solution which uses two subqueries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> weather.origin, name, <span class="dt">month</span>, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">AVG</span>(temp) <span class="kw">AS</span> mean_temp, <span class="fu">AVG</span>(humid) <span class="kw">AS</span> mean_humid</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> weather</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> airports <span class="kw">ON</span> weather.origin <span class="op">=</span> airports.faa</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> origin, name, <span class="dt">month</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> (origin, mean_temp) <span class="kw">IN</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">SELECT</span> origin, <span class="fu">MAX</span>(mean_temp)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">SELECT</span> weather.origin, name, <span class="dt">month</span>, </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(temp) <span class="kw">AS</span> mean_temp, <span class="fu">AVG</span>(humid) <span class="kw">AS</span> mean_humid</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">FROM</span> weather</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">JOIN</span> airports <span class="kw">ON</span> weather.origin <span class="op">=</span> airports.faa</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">GROUP</span> <span class="kw">BY</span> origin, name, <span class="dt">month</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">ORDER</span> <span class="kw">BY</span> origin, <span class="dt">month</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> origin</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a> );</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">mean_temp</th>
<th style="text-align: right;">mean_humid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">78.73492</td>
<td style="text-align: right;">71.74469</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80.76425</td>
<td style="text-align: right;">62.26404</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80.70300</td>
<td style="text-align: right;">66.67641</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>However, the problem with this solution is that it requires us to create the results from question 27 <strong>twice</strong>, which is quite inefficient. Instead, we could store the results from question 27, then use these results. Here is what those queries might look like (again, I don’t expect you to be able to do this part for the exam):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> monthly_weather <span class="kw">AS</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">SELECT</span> weather.origin, name, <span class="dt">month</span>, </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">AVG</span>(temp) <span class="kw">AS</span> mean_temp, <span class="fu">AVG</span>(humid) <span class="kw">AS</span> mean_humid</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> weather</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">JOIN</span> airports <span class="kw">ON</span> weather.origin <span class="op">=</span> airports.faa</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> origin, name, <span class="dt">month</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> monthly_weather</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (origin, mean_temp) <span class="kw">IN</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">SELECT</span> origin, <span class="fu">MAX</span>(mean_temp)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> monthly_weather</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">GROUP</span> <span class="kw">BY</span> origin);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">mean_temp</th>
<th style="text-align: right;">mean_humid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80.70300</td>
<td style="text-align: right;">66.67641</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">80.76425</td>
<td style="text-align: right;">62.26404</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">78.73492</td>
<td style="text-align: right;">71.74469</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="conceptual-questions" class="level2">
<h2 class="anchored" data-anchor-id="conceptual-questions">Conceptual questions</h2>
<ol start="30" type="1">
<li>What are the differences between <code>SELECT</code> in a SQL query, and the <code>select</code> function from <code>dplyr</code> in R?</li>
</ol>
<p><strong>Solution:</strong> The <code>select</code> function from the <code>dplyr</code> package has one function: selecting columns from the data frame. We don’t use the <code>select</code> function to create new columns or summary statistics – those roles are performed by, respectively, the <code>mutate</code> and <code>summarize</code> functions. However, in SQL <code>SELECT</code> does all of this. Choosing existing columns, creating a new column, or creating aggregates of existing columns all happen with <code>SELECT</code>.</p>
<ol start="31" type="1">
<li>Suppose you are managing a database for a hospital. List four different tables which might be included in the hospital database. For each table:</li>
</ol>
<ul>
<li>Describe what information would be included (what would a row represent? what would be some of the columns?)</li>
<li>Is there a natural primary key for the table? What column or set of columns would form that primary key?</li>
<li>Are there any columns in the table that would be foreign keys for other tables in the database?</li>
</ul>
<p><strong>Solution:</strong> There is not just one right answer here. Here is one possible answer.</p>
<p>Tables:</p>
<ul>
<li><code>Patients</code>: information on each patient that has been treated at the hospital
<ul>
<li>Primary key:
<ul>
<li><code>MRN</code> (medical record number), a unique identifier assigned to each patient in the healthcare organization</li>
</ul></li>
<li>Other columns
<ul>
<li>Date of birth</li>
<li>Sex</li>
<li>Insurance</li>
<li>Address</li>
<li>Phone number</li>
</ul></li>
</ul></li>
<li><code>Staff</code>: information on doctors, nurses, etc. who have worked at the hospital
<ul>
<li>Primary key:
<ul>
<li><code>ID</code> employee ID</li>
</ul></li>
<li>Other columns
<ul>
<li>Role</li>
<li>Employment status</li>
<li>Age</li>
<li>Area(s) of specialty</li>
<li>Department</li>
</ul></li>
</ul></li>
<li><code>Pharmacy</code>: information on drugs prescribed to patients in the hospital
<ul>
<li>Foreign keys:
<ul>
<li><code>PatientID</code> refers to <code>MRN</code> in the <code>Patients</code> table. Patient to whom drug was prescribed</li>
<li><code>StaffID</code> refers to <code>ID</code> in the <code>Staff</code> table. Staff member who prescribed the drug</li>
</ul></li>
<li>Other columns
<ul>
<li>Date prescribed</li>
<li>Drug</li>
<li>Dosage</li>
</ul></li>
</ul></li>
<li><code>Visits</code>: information on each visit
<ul>
<li>Foreign keys:
<ul>
<li><code>PatientID</code> refers to <code>MRN</code> in the <code>Patients</code> table</li>
</ul></li>
<li>Other columns
<ul>
<li>Check-in time</li>
<li>Check-out time</li>
<li>Reason for visit</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="practice-with-function-scoping" class="level1">
<h1>Practice with function scoping</h1>
<ol start="32" type="1">
<li>What will be the output of the following code?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>test_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">11</span>){</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">test_fun</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<ol start="33" type="1">
<li>What will be the output of the following code?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>test_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">y =</span> <span class="dv">11</span>){</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">test_fun</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<ol start="34" type="1">
<li>What will be the output of the following code?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>test_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">y =</span> <span class="dv">11</span>){</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">test_fun</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<ol start="35" type="1">
<li>What will be the output of the following code?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>test_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">11</span>){</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">test_fun</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<ol start="36" type="1">
<li>What will be the output of the following code?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>test_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">11</span>){</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">test_fun</span>(x)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
</section>
<section id="practice-with-lists" class="level1">
<h1>Practice with lists</h1>
<ol start="37" type="1">
<li>Create a list <code>x</code> in R such that:</li>
</ol>
<ul>
<li><code>x[[1]]</code> returns the function <code>mean</code></li>
<li><code>x[[2]]</code> returns the function <code>sd</code></li>
<li><code>x[[3]][[1]]</code> returns the vector <code>c(0, 1, 2)</code></li>
<li><code>x[[3]][[2]]</code> returns a function which calculates the cube root of a vector</li>
</ul>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(mean, sd, <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">function</span>(y) y<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">1</span>]](<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">2</span>]](<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.02765</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">3</span>]][[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">3</span>]][[<span class="dv">2</span>]](<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">27</span>, <span class="dv">64</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>