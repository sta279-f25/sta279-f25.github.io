---
title: "Exam 2 review"
format: html
editor: source
---

Below are questions to help you study for Exam 2. These are some examples of the kinds of questions I might ask.

* This is not a practice exam. There will be fewer questions on the actual exam.
* The questions cover most, but not all, possible material for the exam.
* The distribution of questions here is not necessarily reflective of the distribution of questions on the actual exam.

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
```


# Strings and regular expressions

## Example 1

Consider the following strings:

```{r, echo=F}
strings <- c(
  "George Washington: February 22, 1732",
  "Thomas Jefferson: April 13, 1743",
  "Abraham Lincoln: February 12, 1809",
  "Theodore Roosevelt: October 27, 1858"
)

strings
```

For each question below, fill in the R code to produce the desired output.

1.

```{r, eval=F}
str_extract(strings, ...)
```

```{r, echo=F}
str_extract(strings, ".+(?=:)")
```

2.


```{r, eval=F}
str_extract(strings, ...)
```

```{r, echo=F}
str_extract(strings, "(?<=: ).+")
```

3.

```{r, eval=F}
str_extract(strings, ...)
```

```{r, echo=F}
str_extract(strings, "(?<=\\s).+(?=:)")
```

4.

```{r, eval=F}
str_extract(strings, ...)
```

```{r, echo=F}
str_extract(strings, "(?<=, ).+")
```

## Example 2

Consider the following strings:

```{r, echo=F}
strings <- c("apple", "banana", "canteloupe", "durian",
             "eggplant", "french fries", "goat cheese",
             "pizza", "99 red balloons", "101 dalmatians",
             "route 66")
```

```{r}
strings
```


For each question below, fill in the R code to produce the desired output.

5.

```{r, eval=F}
str_subset(strings, ...)
```

```{r, echo=F}
str_subset(strings, "\\d+")
```

6.

```{r, eval=F}
str_subset(strings, ...)
```

```{r, echo=F}
str_subset(strings, "^\\d+")
```

7.

```{r, eval=F}
str_subset(strings, ...)
```

```{r, echo=F}
str_subset(strings, "a")
```

8.

```{r, eval=F}
str_subset(strings, ...)
```

```{r, echo=F}
str_subset(strings, "\\s")
```

9.

```{r, eval=F}
str_subset(strings, ...)
```

```{r, echo=F}
str_subset(strings, "(.)\\1{1}")
```

## Example 3

Suppose you receive a vector containing the following email addresses:

```{r}
emails <- c("evansc@wfu.edu",
            "dalzelnm@wfu.edu",
            "heplersa@wfu.edu")
```

10. Fill in the following code to produce the desired output:

```{r, eval=F}
str_extract(emails, ...)
```

```{r, echo=F}
str_extract(emails, "^.+(?=@)")
```

## Example 4

You have a folder with the following filenames:

```{r}
filenames <- c(".bash_profile",
               "workspace.doc",
               "img0912.jpg",
               "updated_img0912.png",
               "documentation.html",
               "favicon.gif",
               "access.lock")
```


11. Fill in the following code to produce the desired output:

```{r, eval=F}
str_subset(filenames, ...)
```

```{r, echo=F}
str_subset(filenames, "(gif|png|jpg)")
```

## Example 5

Consider the following string:

```{r}
ex_str <- "The kurtosis is defined by the equation $\\mu_4/\\sigma^4$, 
where $\\mu_4$ is the fourth central moment 
and $\\sigma$ is the standard deviation."
```

12. Fill in the following code to produce the desired output:

```{r, eval=F}
str_extract_all(ex_str, ...)
```

```{r, echo=F}
str_extract_all(ex_str, "\\$[^\\$]+\\$")
```

## Example 6

Here is another small dataset, `ex_df`, which has a single column (`faculty`):

```{r, include=F}
ex_df <- data.frame(faculty = c("Rob Erhardt, Professor: MAN 343",
                "Daniel Beavers, Associate Professor: MAN 337",
                "Kenneth Berenhaut, Professor: MAN 379",
                "Leonardo Cella, Assistant Professor: MAN 344",
                "Lucy D'Agostino McGowan, Assistant Professor: MAN 342",
                "Nicole Dalzell, Associate Teaching Professor: MAN 338"))
```

```{r}
ex_df
```

13. Write code to produce the following output using `ex_df`:

```{r, echo=F}
ex_df |>
  separate_wider_regex(faculty,
                       patterns = c(
                         name = ".+",
                         ", ",
                         position = ".+",
                         ": ",
                         office = ".+"
                       ))
```


# Web scraping

## Example 1

Consider the following portion of a web page:

<h1> STA 279 </h1>

<p> 
  Welcome to STA 279! This is a 16-week course offered at Wake Forest University, which meets 3 hours each week. The syllabus can be found <a href='https://sta279-f25.github.io/about/'>here</a> 
</p>

<p>
  Below are some useful dates for the semester:
   <table>
  <tr>
    <td>Exam 1</td>
    <td>March 1</td>
  </tr>
  <tr>
    <td>Exam 2</td>
    <td>April 12</td>
  </tr>
</table> 
</p>

Now here is the source HTML for that simple web page:

```
<h1> STA 279 </h1>

<p> 
  Welcome to STA 279! 
  This is a 16-week course offered at Wake Forest University, 
  which meets 3 hours each week. 
  The syllabus can be found 
  <a href='https://sta279-f25.github.io/about/'>here</a> 
</p>

<p>
  Below are some useful dates for the semester:
   <table>
  <tr>
    <td>Exam 1</td>
    <td>March 1</td>
  </tr>
  <tr>
    <td>Exam 2</td>
    <td>April 12</td>
  </tr>
</table> 
</p>
```

14. Suppose that the url for this page is "https://fake_web_page.html". Write code that will import the table of exam dates into R, as a data frame.

15. Suppose that the url for this page is "https://fake_web_page.html". What will the following code return?

```{r, eval=F}
read_html("https://fake_web_page.html") |>
  html_element("h1") |>
  html_text2() |>
  str_extract("\\d+")
```

## Example 2

Consider the following short portion of a web page, with URL `https://fake_page.html`.

```
<div class="mesa">
  <span>
    <p> Hello! </p>
  </span>
  
  <p class="small"> Welcome to STA 279! </p>
  
  <span>
    <p class="small"> Room: Carswell 102 </p>
  </span>
  
  <span>
    <h3 class="small"> Grading policy </h3>
  </span>
  
  <span>
    <p class="small"> Exam dates </p>
  </span>
</div>
```

16. Write code in R that will extract the following string from this web page:

```{r, include=F}
res_strs <- c("Carswell 102")
```

```{r, echo=F}
res_strs
```

17. Using your code from the previous question, write a short function with the following specifications:
    * Input: `url` the URL for a web page with the same format as above
    * Output: the building and room number for the class, scraped from the web page

18. Suppose that we have the web pages for 20 different classes at Wake Forest, all of which have the same format as shown above, but which take places in different rooms. The URLS are stored in a vector:

```{r, include=F}
class_urls <- paste0("https://fake_page_", 1:20, ".html")
```

```{r}
class_urls
```

Using your answers to the previous questions, iterate over this vector of URLs to produce a vector containing the building and room number for each class.





## Polite web scraping

19. Why is it important to be polite when scraping from a website?

20. What are the features of polite web scraping that we discussed in class?


# SQL

Here is a rough summary of what you should know from the SQL unit:

* Pieces of a SQL query you should know:
  * `SELECT`
  * `FROM`
  * `JOIN` (an inner join) and `LEFT JOIN` (a left join)
  * `WHERE`
  * `GROUP BY`
  * `HAVING`
  * `ORDER BY`
  * `LIMIT`
* You should also know the order in which queries must be written
* Other functions to know for queries:
  * `DISTINCT`
  * Summary functions like `SUM`, `AVG`, `MIN`, `MAX`, `COUNT`
  * `LIKE`, and the wildcards `%` and `_`
  * `CASE`
* The function of primary and foreign keys, and the constraints they place on tables
* How to read and interpret an ERD
* You should be able to read and interpet the results of `DESCRIBE`, `ALTER TABLE`, and `INSERT INTO` statements. You will *not* have to write these statements
* Subqueries

## Practice with SQL queries

Here is a small table in a SQL database. The name of the table is `small_penguins`.

```{r, echo=F, message=F, warning=F}
library(tidyverse)
library(palmerpenguins)

set.seed(3)

sub_data <- penguins |>
  slice_sample(n=10) |>
  select(species, island, bill_length_mm, bill_depth_mm)

sub_data |>
  data.frame()
```

In each of the following examples, write a SQL query to produce the desired output from `small_penguins`.

21. Output:

```{r, echo=F}
sub_data |>
  count(species, island) |>
  data.frame()
```

22. Output:

```{r, echo=F}
sub_data |>
  group_by(island, species) |>
  summarize(mean_length = mean(bill_length_mm, na.rm=T)) |>
  data.frame()
```


23. Output:

```{r, echo=F}
sub_data |>
  mutate(bill_ratio = bill_length_mm/bill_depth_mm) |>
  data.frame()
```


24. Output:

```{r, echo=F}
sub_data |>
  filter(species == "Adelie", 
         island == "Dream") |>
  data.frame()
```


## Joins

In each of the following questions, write a SQL query to produce the desired output from the two input tables

25.

```{r, echo=F}
df1 <- data.frame(
  id = c(1, 2, 3),
  x = c(7, 9, 13)
)

df2 <- data.frame(
  id = c(1, 2, 4),
  y = c(10, 12, 14)
)
```

```{r}
df1

df2
```


Output:

```{r, echo=F}
df1 |>
  left_join(df2, join_by(id))
```


26.

```{r}
df1

df2
```


Output:

```{r, echo=F}
df1 |>
  inner_join(df2, join_by(id))
```

## More practice with SQL queries

The `nycflights13` package in R contains several datasets describing flights from NY airports in 2013, including the `airports` and `weather` tables. 

The `airports` table has one row for each different airport in the database. There are a total of 1458 rows and 8 columns in the `airports` table; here are a few random rows from the table, showing the relevant columns for this question:

```{r, echo=F, message=F, warning=F}
library(nycflights13)

airports |>
  select(faa, name) |>
  slice_sample(n=5) |>
  data.frame()
```

The `weather` table has one row for each date-time, for each of the three NY airports (EWR, JFK, LGA), and records a variety of weather variables at each time for each location. Here are a few random rows from the table, showing the relevant columns for this question:

```{r, echo=F}
weather |>
  select(origin, month, temp, humid) |>
  slice_sample(n=5) |>
  data.frame()
```

The `weather` table uses a 3-character FAA code to identify each airport. It does *not* include the full name for the airports. 

We would like to produce a table with the mean temperature, and humidity for each month, for each of the 3 NYC airports in the database. The output table should also include the full name of each airport. Here is what the output table looks like:

```{r, echo=F}
weather |>
  group_by(origin, month) |>
  summarize(mean_temp = mean(temp, na.rm=T),
            mean_humid = mean(humid, na.rm=T)) |>
  inner_join(airports, join_by(origin == faa)) |>
  select(origin, name, month, mean_temp, mean_humid) |>
  data.frame()
```

27. Write a SQL query to produce the desired results.

28. How would you modify your above query to keep only the rows in the results for which the mean temperature is at least 60?

29. How would you modify your above query to keep only the rows for which the mean temperature is the highest average temperature?


## Conceptual questions

30. What are the differences between `SELECT` in a SQL query, and the `select` function from `dplyr` in R?

31. Suppose you are managing a database for a hospital. List four different tables which might be included in the hospital database. For each table:
  * Describe what information would be included (what would a row represent? what would be some of the columns?)
  * Is there a natural primary key for the table? What column or set of columns would form that primary key?
  * Are there any columns in the table that would be foreign keys for other tables in the database?

# Practice with function scoping

32. What will be the output of the following code?

```{r, eval=F}
x <- 10
test_fun <- function(x = 11){
  return(x)
}
test_fun()
x
```

33. What will be the output of the following code?

```{r, eval=F}
x <- 10
test_fun <- function(y = 11){
  return(x + 1)
}
test_fun()
x
```

34. What will be the output of the following code?

```{r, eval=F}
x <- 10
test_fun <- function(y = 11){
  x <- x + 1
  return(x + 1)
}
test_fun()
x
```

35. What will be the output of the following code?

```{r, eval=F}
x <- 10
test_fun <- function(x = 11){
  x <- x + 1
  return(x + 1)
}
test_fun()
x
```

36. What will be the output of the following code?

```{r, eval=F}
x <- 10
test_fun <- function(x = 11){
  x <- x + 1
  return(x + 1)
}
x <- test_fun(x)
x
```

# Practice with lists

37. Create a list `x` in R such that:

* `x[[1]]` returns the function `mean`
* `x[[2]]` returns the function `sd`
* `x[[3]][[1]]` returns the vector `c(0, 1, 2)`
* `x[[3]][[2]]` returns a function which calculates the cube root of a vector







